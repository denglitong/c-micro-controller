# C 语言单片机学习

学习路线： 单片机 -> ARM 嵌入式系统 -> FPGA 设计 -> 上位机软件

模拟电路、数字电路、原理图设计、PCB 布板

## 开发环境

- Editor: CLion
- Plugin: PlatformIO for CLion, Ini
- Platform CLI: brew install platformio

Open the PlatformIO Home in Chrome:

```bash
pio -c clion home
```

## 单片机编程思想

- 计算机基本操作

      计算机执行一条指令时会划分为若干个阶段，
      每个阶段完成一项工作，如取指令、存储器读、存储器写等，
      这里的每一项工作称为一个基本操作（取指令/存储器读写等）。

- 机器周期 vs 指令周期

      完成一个计算机基本操作所需要的时间称为机器周期。
      一个机器周期由若干个状态周期组成。
      8051 系列单片机一个机器周期 = 6 状态周期。
      8051 系列单片机一个状态周期由 2 个时钟周期组成。
      8051 单片机机器周期 = 12 时钟周期。 

- 延时检测 vs 中断检测

      需要检测状态时，不允许在程序中显式延时以等待状态成立，
      要么检测状态不稳定，要么导致性能低下；
      应该使用定时器中断（interrupt）来检测状态，
      在中断周期的定时器中断函数里面内不断检测状态，
      然后利用多次检测结果来结合一定的鲁棒/消抖算法来确定某个状态成立。

- 状态检测 和 控制逻辑 分离

      在主循环中，一般是根据器件状态做不同的控制逻辑；
      和中断函数中，一般是利用中断周期做检测逻辑（检测、更新器件状态）;
      当然，如果在主循环中根据状态更新了其他数据，
      也可以在中断函数内显示这部分数据。

- 一次只做一件事

      一次只做一件事，利于封装、隔离、抽象；
      
      在时钟中断周期内，中断函数能做的事情是有限的，取决于中断周期，
      一般中断周期是很短的，不足于做很多事情；

      所以在中断函数内最好只检测一个器件的状态，
      如果有一系列的器件需要检测状态，那么保持一个器件 Index 状态，
      在每次中断周期内只检测其中一个 Index 的器件，然后递增 Index；
      这样在中断周期连续运行时，看起来的表现依然是顺序检测了所有的器件。

## 参考教程

1. [51单片机应用从零开始](https://bbs.elecfans.com/jishu_1456752_1_1.html)
2. [手把手教你学51单片机 — C语言版（金沙滩 官方) ](https://www.bilibili.com/video/BV1RJ411k74J)
3. [吴坚鸿—手把手教你单片机程序框架](https://bbs.elecfans.com/jishu_1456751_1_1.html)